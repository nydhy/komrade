import{r as c,q as N,j as e,A as o,B as y,C as f}from"./index-BjFXoSI1.js";function x(a){switch(a){case"HIGH":return"severity-high";case"MED":return"severity-med";case"LOW":return"severity-low";default:return""}}function h({recipients:a}){return e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-secondary text-sm",children:"Recipients:"}),e.jsx("ul",{className:"mt-1 flex-col gap-xs",style:{listStyle:"none",paddingLeft:0},children:a.map(t=>e.jsxs("li",{className:"text-sm",children:[e.jsxs("span",{className:"text-secondary",children:["• ",t.buddy_name]}),e.jsxs("span",{className:"text-muted",children:[" — ",t.status]}),t.status==="ACCEPTED"||t.status==="DECLINED"?e.jsxs("div",{className:"text-muted text-xs mt-1",style:{paddingLeft:"1rem"},children:[t.message?`"${t.message}"`:"(no message)",t.status==="ACCEPTED"&&t.eta_minutes!=null&&e.jsxs(e.Fragment,{children:[" · ETA: ",t.eta_minutes," min"]}),t.responded_at&&e.jsxs(e.Fragment,{children:[" · ",new Date(t.responded_at).toLocaleString()]})]}):e.jsx("div",{className:"text-muted text-xs mt-1",style:{paddingLeft:"1rem"},children:"(no response yet)"})]},t.id))})]})}function v(){const[a,t]=c.useState([]),[u,g]=c.useState(!0);async function p(){try{const s=await o(50);t(s)}catch{}finally{g(!1)}}c.useEffect(()=>{p()},[]),N(["sos.recipient_updated","sos.closed"],()=>{o(50).then(t).catch(()=>{})});async function j(s){try{const n=await y(s);t(i=>i.map(m=>m.id===s?n:m))}catch{}}async function d(s){if(confirm("Delete this SOS alert and all its notifications? This cannot be undone."))try{await f(s),t(n=>n.filter(i=>i.id!==s))}catch{}}if(u)return e.jsxs("div",{className:"page-container animate-in",children:[e.jsx("h1",{className:"heading-lg text-gradient",children:"SOS History"}),e.jsx("div",{className:"card loading-shimmer skeleton-card mt-6"})]});const l=a.filter(s=>s.status!=="CLOSED"),r=a.filter(s=>s.status==="CLOSED");return e.jsxs("div",{className:"page-container animate-in",children:[e.jsx("h1",{className:"heading-lg text-gradient mb-6",children:"SOS History"}),a.length===0?e.jsx("div",{className:"card",children:e.jsx("p",{className:"text-muted text-sm text-center",children:"No SOS alerts yet."})}):e.jsxs(e.Fragment,{children:[l.length>0&&e.jsxs("section",{className:"mb-6",children:[e.jsx("h2",{className:"heading-md mb-4",children:"Active Alerts"}),e.jsx("div",{className:"flex-col gap-md",children:l.map((s,n)=>e.jsxs("div",{className:`card ${x(s.severity)} sos-pulse animate-in animate-in-delay-${Math.min(n,4)}`,children:[e.jsxs("div",{className:"flex-between",children:[e.jsxs("div",{className:"flex-center gap-sm",children:[e.jsx("span",{className:"status-dot status-dot-danger"}),e.jsxs("strong",{className:"heading-sm",children:["SOS #",s.id," — ",s.trigger_type," / ",s.severity]}),e.jsx("span",{className:"badge badge-danger",children:s.status})]}),e.jsxs("div",{className:"flex-center gap-sm",children:[e.jsx("button",{type:"button",onClick:()=>j(s.id),className:"btn btn-ghost btn-sm",children:"Close"}),e.jsx("button",{type:"button",onClick:()=>d(s.id),className:"btn btn-danger btn-sm",children:"Delete"})]})]}),e.jsx(h,{recipients:s.recipients}),e.jsxs("p",{className:"text-muted text-xs mt-1",children:["Created: ",new Date(s.created_at).toLocaleString()]})]},s.id))})]}),r.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"heading-md mb-4",children:"Closed Alerts"}),e.jsx("div",{className:"flex-col gap-md",children:r.map((s,n)=>e.jsxs("div",{className:`card ${x(s.severity)} animate-in animate-in-delay-${Math.min(n,4)}`,children:[e.jsxs("div",{className:"flex-between",children:[e.jsxs("div",{className:"flex-center gap-sm",children:[e.jsx("span",{className:"status-dot status-dot-offline"}),e.jsxs("strong",{className:"heading-sm",children:["SOS #",s.id," — ",s.trigger_type," / ",s.severity]}),e.jsx("span",{className:"badge",children:s.status})]}),e.jsx("button",{type:"button",onClick:()=>d(s.id),className:"btn btn-danger btn-sm",children:"Delete"})]}),e.jsx(h,{recipients:s.recipients}),e.jsxs("p",{className:"text-muted text-xs mt-1",children:["Created: ",new Date(s.created_at).toLocaleString(),s.closed_at&&` · Closed: ${new Date(s.closed_at).toLocaleString()}`]})]},s.id))})]})]})]})}export{v as default};
