import{r as a,j as e,o as C,q as _,t as D}from"./index-BjFXoSI1.js";const A={HIGH:"severity-high",MED:"severity-med",LOW:"severity-low"},B={HIGH:"badge badge-danger",MED:"badge badge-warning",LOW:"badge badge-success"},j={NOTIFIED:{label:"Pending",className:"badge badge-warning"},ACCEPTED:{label:"Accepted",className:"badge badge-success"},DECLINED:{label:"Declined",className:"badge badge-danger"},NO_RESPONSE:{label:"No Response",className:"badge"}};function w(s){return new Date(s).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function f({alert:s,onResponded:u}){const[i,h]=a.useState(""),[d,y]=a.useState(""),[n,l]=a.useState(!1),[m,t]=a.useState(null),[g,x]=a.useState(!1),p=j[s.my_status]??j.NO_RESPONSE,v=A[s.severity]??"",E=B[s.severity]??"badge",c=s.alert_status==="CLOSED",b=s.my_status==="ACCEPTED"||s.my_status==="DECLINED";async function N(o){l(!0),t(null);try{const r=d?parseInt(d,10):void 0;if(r!==void 0&&(r<1||r>120)){t("ETA must be between 1 and 120 minutes"),l(!1);return}await C(s.alert_id,{status:o,message:i||void 0,eta_minutes:o==="ACCEPTED"?r:void 0}),u()}catch(r){t(r instanceof Error?r.message:"Failed to respond")}finally{l(!1)}}const S=["card","card-hover",v,c?"":"card-glow",s.severity==="HIGH"&&!c?"card-highlight-danger":"",s.severity==="MED"&&!c?"card-highlight-warning":"",s.severity==="LOW"&&!c?"card-highlight-success":"","animate-in"].filter(Boolean).join(" ");return e.jsxs("div",{className:S,style:{marginBottom:"0.75rem"},children:[e.jsxs("div",{className:"flex-between",style:{flexWrap:"wrap",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsxs("span",{className:"heading-sm",style:{margin:0},children:["SOS from ",s.veteran_name]}),e.jsx("span",{className:E,children:s.severity}),e.jsx("span",{className:"badge badge-info",children:s.trigger_type})]}),e.jsx("span",{className:p.className,children:p.label})]}),e.jsxs("div",{className:"text-muted",style:{fontSize:"0.85rem",marginBottom:"0.5rem"},children:[w(s.created_at),c&&e.jsx("span",{style:{marginLeft:"0.5rem"},children:"(Closed)"})]}),b&&e.jsxs("div",{className:"card",style:{padding:"0.5rem 0.75rem",marginBottom:"0.5rem"},children:[s.my_status==="ACCEPTED"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsx("span",{className:"badge badge-success",children:"âœ“ You accepted"}),s.my_eta_minutes&&e.jsxs("span",{className:"text-secondary",style:{fontSize:"0.85rem"},children:["ETA: ",s.my_eta_minutes," min"]})]}),s.my_status==="DECLINED"&&e.jsx("span",{className:"badge badge-danger",children:"âœ— You declined"}),s.my_message&&e.jsxs("div",{className:"text-muted",style:{marginTop:"0.35rem",fontStyle:"italic",fontSize:"0.85rem"},children:['"',s.my_message,'"']})]}),!c&&e.jsx("div",{style:{marginTop:"0.5rem"},children:g?e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{style:{marginBottom:"0.75rem"},children:[e.jsx("label",{className:"text-secondary",style:{display:"block",fontSize:"0.85rem",marginBottom:"0.35rem",fontWeight:500},children:"Message (optional)"}),e.jsx("input",{type:"text",className:"input",value:i,onChange:o=>h(o.target.value),placeholder:"e.g. On my way!"})]}),e.jsxs("div",{style:{marginBottom:"0.75rem"},children:[e.jsx("label",{className:"text-secondary",style:{display:"block",fontSize:"0.85rem",marginBottom:"0.35rem",fontWeight:500},children:"ETA in minutes (1â€“120, optional)"}),e.jsx("input",{type:"number",className:"input",value:d,onChange:o=>y(o.target.value),placeholder:"e.g. 15",min:1,max:120,style:{maxWidth:140}})]}),m&&e.jsx("div",{className:"alert alert-danger",style:{marginBottom:"0.75rem",padding:"0.5rem 0.75rem",fontSize:"0.85rem"},children:m}),e.jsxs("div",{className:"gap-sm",style:{display:"flex"},children:[e.jsx("button",{type:"button",className:"btn btn-success btn-sm",onClick:()=>N("ACCEPTED"),disabled:n,children:"Accept"}),e.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:()=>N("DECLINED"),disabled:n,children:"Decline"}),e.jsx("button",{type:"button",className:"btn btn-ghost btn-sm",onClick:()=>{x(!1),t(null)},children:"Cancel"})]})]}):e.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>x(!0),children:b?"Change Response":"Respond"})})]})}function I(){const[s,u]=a.useState([]),[i,h]=a.useState(!0),[d,y]=a.useState(null);async function n(){y(null),h(!0);try{const t=await D();u(t)}catch(t){y(t instanceof Error?t.message:"Failed to load inbox")}finally{h(!1)}}a.useEffect(()=>{n()},[]),_(["sos.created","sos.closed"],()=>{n()});const l=s.filter(t=>t.alert_status!=="CLOSED"),m=s.filter(t=>t.alert_status==="CLOSED");return e.jsxs("div",{className:"page-container animate-in",children:[e.jsxs("div",{className:"flex-between",style:{marginBottom:"1.5rem"},children:[e.jsx("h1",{className:"heading-lg",children:"Buddy Inbox"}),e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:n,disabled:i,children:i?"Refreshing...":"â†» Refresh"})]}),d&&e.jsx("div",{className:"alert alert-danger animate-in",style:{marginBottom:"1rem"},children:e.jsx("p",{style:{margin:0},children:d})}),i&&s.length===0&&e.jsx("div",{className:"card animate-in",style:{textAlign:"center",padding:"2rem"},children:e.jsx("p",{className:"text-muted",children:"Loading incoming alerts..."})}),!i&&s.length===0&&e.jsxs("div",{className:"card animate-in",style:{textAlign:"center",padding:"3rem 1.5rem"},children:[e.jsx("div",{style:{fontSize:"2.5rem",marginBottom:"0.75rem",opacity:.5},children:"ðŸ“­"}),e.jsx("p",{className:"heading-sm",style:{marginBottom:"0.25rem"},children:"No incoming SOS alerts"}),e.jsx("p",{className:"text-muted",children:"When a veteran you're connected with sends an SOS, it will appear here."})]}),l.length>0&&e.jsxs("section",{style:{marginBottom:"2rem"},children:[e.jsxs("h2",{className:"heading-sm",style:{marginBottom:"0.75rem"},children:["Active Alerts",e.jsx("span",{className:"badge badge-danger",style:{marginLeft:"0.5rem"},children:l.length})]}),l.map((t,g)=>e.jsx("div",{className:`animate-in animate-in-delay-${Math.min(g+1,5)}`,children:e.jsx(f,{alert:t,onResponded:n})},`${t.alert_id}-${t.recipient_id}`))]}),m.length>0&&e.jsxs("section",{children:[e.jsx("div",{className:"divider"}),e.jsxs("h2",{className:"heading-sm text-muted",style:{marginBottom:"0.75rem"},children:["Closed",e.jsx("span",{className:"badge",style:{marginLeft:"0.5rem"},children:m.length})]}),m.map((t,g)=>e.jsx("div",{className:`animate-in animate-in-delay-${Math.min(g+1,5)}`,style:{opacity:.6},children:e.jsx(f,{alert:t,onResponded:n})},`${t.alert_id}-${t.recipient_id}`))]})]})}export{I as default};
