import{r as n,j as e,g as D}from"./index-g3GU5JoN.js";import{g as I,u as M}from"./auth-D6vILSCL.js";import{s as N}from"./geocode-Cak2rTCs.js";import"./http-vazCWv24.js";function J(){const[a,x]=n.useState(null),[L,R]=n.useState(!0),[l,h]=n.useState(!1),[y,i]=n.useState(null),[E,c]=n.useState(!1),[b,S]=n.useState(""),[_,d]=n.useState(""),[u,s]=n.useState(""),[j,f]=n.useState(null),[v,g]=n.useState(null),[m,k]=n.useState([]),[F,w]=n.useState(!1),[p,z]=n.useState(!1);n.useEffect(()=>{async function t(){try{const o=D();if(!o)return;const r=await I(o);if(x(r),S(r.full_name),f(r.latitude),g(r.longitude),r.latitude&&r.longitude)try{const B=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${r.latitude}&lon=${r.longitude}&format=json`,{headers:{"Accept-Language":"en"}});if(B.ok){const A=(await B.json()).display_name||`${r.latitude.toFixed(4)}, ${r.longitude.toFixed(4)}`;s(A),d(A)}}catch{s(`${r.latitude.toFixed(4)}, ${r.longitude.toFixed(4)}`)}}catch(o){i(o instanceof Error?o.message:"Failed to load profile")}finally{R(!1)}}t()},[]);async function T(t){d(t),s(""),w(!0);const o=await N(t);k(o),w(!1)}function P(t){f(t.lat),g(t.lon),s(t.display_name),d(t.display_name),k([])}async function $(){z(!0),i(null);try{const t=await fetch("https://ipapi.co/json/");if(!t.ok)throw new Error("IP geolocation unavailable");const o=await t.json();if(o.latitude&&o.longitude){f(o.latitude),g(o.longitude);const r=[o.city,o.region,o.country_name].filter(Boolean).join(", ");s(r||`${o.latitude.toFixed(4)}, ${o.longitude.toFixed(4)}`),d(r||"")}else throw new Error("Could not determine location")}catch(t){i(t instanceof Error?t.message:"Auto-detect failed")}finally{z(!1)}}async function W(t){t.preventDefault(),h(!0),i(null),c(!1);try{const o=await M({full_name:b||void 0,latitude:j??void 0,longitude:v??void 0});x(o),c(!0),setTimeout(()=>c(!1),3e3)}catch(o){i(o instanceof Error?o.message:"Failed to save profile")}finally{h(!1)}}if(L)return e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading profile..."});const C={width:"100%",padding:"10px 12px",border:"2px solid #e0e0e0",borderRadius:8,fontSize:"0.95rem",outline:"none",backgroundColor:"#fafafa",boxSizing:"border-box"};return e.jsxs("div",{style:{maxWidth:520,margin:"0 auto",padding:"1rem"},children:[e.jsx("h1",{style:{marginBottom:"0.5rem"},children:"My Profile"}),e.jsx("p",{style:{color:"#666",fontSize:"0.9rem",marginTop:0,marginBottom:"1.5rem"},children:"Update your personal information and location"}),y&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#ffebee",border:"1px solid #ef9a9a",borderRadius:8,marginBottom:"1rem"},children:e.jsx("p",{style:{color:"#c62828",margin:0,fontSize:"0.9rem"},children:y})}),E&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#e8f5e9",border:"1px solid #a5d6a7",borderRadius:8,marginBottom:"1rem"},children:e.jsx("p",{style:{color:"#2e7d32",margin:0,fontSize:"0.9rem"},children:"Profile saved successfully."})}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("section",{style:{marginBottom:"1.5rem",padding:"1rem",border:"1px solid #e0e0e0",borderRadius:10,backgroundColor:"#fff"},children:[e.jsx("h2",{style:{fontSize:"1.1rem",marginTop:0,marginBottom:12},children:"Account"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"100px 1fr",gap:"8px 16px",fontSize:"0.9rem"},children:[e.jsx("span",{style:{color:"#888"},children:"Email"}),e.jsx("span",{style:{fontWeight:500},children:a==null?void 0:a.email}),e.jsx("span",{style:{color:"#888"},children:"Role"}),e.jsx("span",{style:{fontWeight:500,textTransform:"capitalize"},children:a==null?void 0:a.role}),e.jsx("span",{style:{color:"#888"},children:"Joined"}),e.jsx("span",{style:{fontWeight:500},children:a!=null&&a.created_at?new Date(a.created_at).toLocaleDateString():""})]})]}),e.jsxs("section",{style:{marginBottom:"1.5rem",padding:"1rem",border:"1px solid #e0e0e0",borderRadius:10,backgroundColor:"#fff"},children:[e.jsx("h2",{style:{fontSize:"1.1rem",marginTop:0,marginBottom:12},children:"Personal Info"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontWeight:600,fontSize:"0.85rem",color:"#424242"},children:"Full Name"}),e.jsx("input",{type:"text",value:b,onChange:t=>S(t.target.value),placeholder:"Your full name",style:C})]})]}),e.jsxs("section",{style:{marginBottom:"1.5rem",padding:"1rem",border:"1px solid #e0e0e0",borderRadius:10,backgroundColor:"#fff"},children:[e.jsx("h2",{style:{fontSize:"1.1rem",marginTop:0,marginBottom:4},children:"Location"}),e.jsxs("p",{style:{color:"#666",fontSize:"0.85rem",margin:"0 0 12px"},children:["Used for matching you with nearby ",(a==null?void 0:a.role)==="veteran"?"buddies":"veterans"]}),j&&v&&u&&e.jsxs("div",{style:{padding:"8px 12px",backgroundColor:"#e3f2fd",borderRadius:6,marginBottom:10,fontSize:"0.85rem",color:"#1565c0"},children:["Current: ",u.split(",").slice(0,3).join(", ")]}),e.jsxs("div",{style:{position:"relative",marginBottom:8},children:[e.jsx("input",{type:"text",value:_,onChange:t=>T(t.target.value),placeholder:"Search city, ZIP code, or address...",style:{...C,borderColor:u?"#43a047":"#e0e0e0"}}),F&&e.jsx("span",{style:{position:"absolute",right:12,top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#999"},children:"Searching..."})]}),m.length>0&&e.jsx("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,marginBottom:8,maxHeight:180,overflowY:"auto",backgroundColor:"#fff",boxShadow:"0 4px 12px rgba(0,0,0,0.08)"},children:m.map((t,o)=>e.jsxs("button",{type:"button",onClick:()=>P(t),style:{display:"block",width:"100%",padding:"8px 12px",border:"none",borderBottom:o<m.length-1?"1px solid #f0f0f0":"none",backgroundColor:"#fff",textAlign:"left",cursor:"pointer",fontSize:"0.83rem",color:"#333"},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="#f5f5f5"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="#fff"},children:[e.jsx("span",{style:{fontWeight:500},children:t.display_name.split(",")[0]}),e.jsx("span",{style:{color:"#888",fontSize:"0.78rem"},children:t.display_name.includes(",")?", "+t.display_name.split(",").slice(1,3).join(",").trim():""})]},o))}),e.jsxs("button",{type:"button",onClick:$,disabled:p,style:{padding:"6px 14px",background:"#fff",border:"1px solid #ccc",borderRadius:6,cursor:p?"default":"pointer",fontSize:"0.83rem",color:"#555",display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{style:{fontSize:"0.9rem"},children:"üìç"}),p?"Detecting...":"Auto-detect my location"]})]}),e.jsx("button",{type:"submit",disabled:l,style:{width:"100%",padding:"14px 24px",background:l?"#90caf9":"linear-gradient(135deg, #1565c0, #1976d2)",color:"#fff",border:"none",borderRadius:10,fontSize:"1rem",fontWeight:600,cursor:l?"default":"pointer",boxShadow:"0 4px 14px rgba(25,118,210,0.4)"},children:l?"Saving...":"Save Profile"})]})]})}export{J as default};
