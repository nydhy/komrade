import{r as n,j as e,u as E}from"./index-g3GU5JoN.js";import{r as v,d as R}from"./sos-BZWgVO14.js";import"./http-vazCWv24.js";const _={HIGH:"#c62828",MED:"#e65100",LOW:"#2e7d32"},j={NOTIFIED:{label:"Pending",color:"#e65100",bg:"#fff3e0"},ACCEPTED:{label:"Accepted",color:"#2e7d32",bg:"#e8f5e9"},DECLINED:{label:"Declined",color:"#c62828",bg:"#ffebee"},NO_RESPONSE:{label:"No Response",color:"#757575",bg:"#f5f5f5"}};function D(t){return new Date(t).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function C({alert:t,onResponded:u}){const[r,g]=n.useState(""),[l,m]=n.useState(""),[s,i]=n.useState(!1),[a,o]=n.useState(null),[S,h]=n.useState(!1),x=j[t.my_status]??j.NO_RESPONSE,f=_[t.severity]??"#333",c=t.alert_status==="CLOSED",y=t.my_status==="ACCEPTED"||t.my_status==="DECLINED";async function b(p){i(!0),o(null);try{const d=l?parseInt(l,10):void 0;if(d!==void 0&&(d<1||d>120)){o("ETA must be between 1 and 120 minutes"),i(!1);return}await v(t.alert_id,{status:p,message:r||void 0,eta_minutes:p==="ACCEPTED"?d:void 0}),u()}catch(d){o(d instanceof Error?d.message:"Failed to respond")}finally{i(!1)}}return e.jsxs("div",{style:{padding:"1rem",border:`1px solid ${c?"#e0e0e0":f}40`,borderLeft:`4px solid ${c?"#bdbdbd":f}`,borderRadius:8,marginBottom:10,backgroundColor:c?"#fafafa":"#fff",opacity:c?.7:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsxs("span",{style:{fontWeight:600,fontSize:"1rem"},children:["SOS from ",t.veteran_name]}),e.jsx("span",{style:{marginLeft:8,padding:"2px 8px",borderRadius:4,fontSize:"0.75rem",fontWeight:600,color:f,backgroundColor:`${f}15`},children:t.severity}),e.jsx("span",{style:{marginLeft:6,padding:"2px 8px",borderRadius:4,fontSize:"0.75rem",color:"#666",backgroundColor:"#f5f5f5"},children:t.trigger_type})]}),e.jsx("span",{style:{padding:"2px 10px",borderRadius:12,fontSize:"0.8rem",fontWeight:600,color:x.color,backgroundColor:x.bg},children:x.label})]}),e.jsxs("div",{style:{marginTop:6,fontSize:"0.85rem",color:"#666"},children:[D(t.created_at),c&&e.jsx("span",{style:{marginLeft:8,color:"#999"},children:"(Closed)"})]}),y&&e.jsxs("div",{style:{marginTop:8,padding:"6px 10px",backgroundColor:"#f5f5f5",borderRadius:6,fontSize:"0.85rem"},children:[t.my_status==="ACCEPTED"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"#2e7d32",fontWeight:500},children:"You accepted"}),t.my_eta_minutes&&e.jsxs("span",{style:{marginLeft:8},children:["ETA: ",t.my_eta_minutes," min"]})]}),t.my_status==="DECLINED"&&e.jsx("span",{style:{color:"#c62828",fontWeight:500},children:"You declined"}),t.my_message&&e.jsxs("div",{style:{marginTop:4,color:"#555",fontStyle:"italic"},children:['"',t.my_message,'"']})]}),!c&&e.jsx("div",{style:{marginTop:10},children:S?e.jsxs("div",{style:{border:"1px solid #e0e0e0",borderRadius:8,padding:"0.75rem",backgroundColor:"#fafafa"},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",marginBottom:4,fontWeight:500},children:"Message (optional)"}),e.jsx("input",{type:"text",value:r,onChange:p=>g(p.target.value),placeholder:"e.g. On my way!",style:{width:"100%",padding:"6px 8px",border:"1px solid #ccc",borderRadius:4}})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",marginBottom:4,fontWeight:500},children:"ETA in minutes (1-120, optional)"}),e.jsx("input",{type:"number",value:l,onChange:p=>m(p.target.value),placeholder:"e.g. 15",min:1,max:120,style:{width:120,padding:"6px 8px",border:"1px solid #ccc",borderRadius:4}})]}),a&&e.jsx("p",{style:{color:"#c62828",fontSize:"0.85rem",margin:"0 0 8px"},children:a}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",onClick:()=>b("ACCEPTED"),disabled:s,style:{padding:"6px 16px",backgroundColor:"#2e7d32",color:"#fff",border:"none",borderRadius:4,cursor:s?"default":"pointer",fontWeight:500},children:"Accept"}),e.jsx("button",{type:"button",onClick:()=>b("DECLINED"),disabled:s,style:{padding:"6px 16px",backgroundColor:"#c62828",color:"#fff",border:"none",borderRadius:4,cursor:s?"default":"pointer",fontWeight:500},children:"Decline"}),e.jsx("button",{type:"button",onClick:()=>{h(!1),o(null)},style:{padding:"6px 12px",backgroundColor:"#fff",border:"1px solid #ccc",borderRadius:4,cursor:"pointer"},children:"Cancel"})]})]}):e.jsx("div",{style:{display:"flex",gap:8},children:e.jsx("button",{type:"button",onClick:()=>h(!0),style:{padding:"6px 16px",backgroundColor:"#2e7d32",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:500},children:y?"Change Response":"Respond"})})})]})}function T(){const[t,u]=n.useState([]),[r,g]=n.useState(!0),[l,m]=n.useState(null);async function s(){m(null),g(!0);try{const o=await R();u(o)}catch(o){m(o instanceof Error?o.message:"Failed to load inbox")}finally{g(!1)}}n.useEffect(()=>{s()},[]),E(["sos.created","sos.closed"],()=>{s()});const i=t.filter(o=>o.alert_status!=="CLOSED"),a=t.filter(o=>o.alert_status==="CLOSED");return e.jsxs("div",{style:{maxWidth:600,margin:"0 auto",padding:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h1",{style:{margin:0},children:"Buddy Inbox"}),e.jsx("button",{type:"button",onClick:s,disabled:r,style:{padding:"6px 14px"},children:r?"Refreshing...":"Refresh"})]}),l&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#ffebee",border:"1px solid #ef9a9a",borderRadius:8,marginBottom:"1rem"},children:e.jsx("p",{style:{color:"#c62828",margin:0},children:l})}),r&&t.length===0&&e.jsx("p",{style:{color:"#666"},children:"Loading incoming alerts..."}),!r&&t.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:"3rem 1rem",color:"#666"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:4},children:"No incoming SOS alerts"}),e.jsx("p",{style:{fontSize:"0.9rem"},children:"When a veteran you're connected with sends an SOS, it will appear here."})]}),i.length>0&&e.jsxs("section",{style:{marginBottom:"2rem"},children:[e.jsxs("h2",{style:{fontSize:"1.1rem",color:"#333",marginBottom:8},children:["Active Alerts (",i.length,")"]}),i.map(o=>e.jsx(C,{alert:o,onResponded:s},`${o.alert_id}-${o.recipient_id}`))]}),a.length>0&&e.jsxs("section",{children:[e.jsxs("h2",{style:{fontSize:"1.1rem",color:"#999",marginBottom:8},children:["Closed (",a.length,")"]}),a.map(o=>e.jsx(C,{alert:o,onResponded:s},`${o.alert_id}-${o.recipient_id}`))]})]})}export{T as default};
