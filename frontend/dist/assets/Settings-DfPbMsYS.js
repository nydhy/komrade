import{g as S,r,j as e}from"./index-g3GU5JoN.js";import{g as k}from"./http-vazCWv24.js";async function w(n,i,a){const l={"Content-Type":"application/json"};a&&(l.Authorization=`Bearer ${a}`);const s=await fetch(`${n}`,{method:"PUT",headers:l,body:JSON.stringify(i)});if(!s.ok){const o=await s.json().catch(()=>({detail:s.statusText}));throw new Error(typeof o.detail=="string"?o.detail:JSON.stringify(o.detail))}return s.json()}async function _(){const n=S();if(!n)throw new Error("Not authenticated");return k("/settings/me",n)}async function E(n){const i=S();if(!i)throw new Error("Not authenticated");return w("/settings/me",n,i)}function R(){const[n,i]=r.useState(null),[a,l]=r.useState(!0),[s,o]=r.useState(!1),[f,c]=r.useState(null),[b,u]=r.useState(!1),[g,p]=r.useState(""),[m,h]=r.useState(""),[x,y]=r.useState(!0);async function j(){try{const t=await _();i(t),p(t.quiet_hours_start??""),h(t.quiet_hours_end??""),y(t.share_precise_location)}catch(t){c(t instanceof Error?t.message:"Failed to load settings")}finally{l(!1)}}r.useEffect(()=>{j()},[]);async function v(t){t.preventDefault(),o(!0),c(null),u(!1);try{const d=await E({quiet_hours_start:g||null,quiet_hours_end:m||null,share_precise_location:x});i(d),u(!0),setTimeout(()=>u(!1),3e3)}catch(d){c(d instanceof Error?d.message:"Failed to save settings")}finally{o(!1)}}return a?e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading settings..."}):e.jsxs("div",{style:{maxWidth:500,margin:"0 auto",padding:"1rem"},children:[e.jsx("h1",{children:"Settings"}),f&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#ffebee",border:"1px solid #ef9a9a",borderRadius:8,marginBottom:"1rem"},children:e.jsx("p",{style:{color:"#c62828",margin:0},children:f})}),b&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#e8f5e9",border:"1px solid #a5d6a7",borderRadius:8,marginBottom:"1rem"},children:e.jsx("p",{style:{color:"#2e7d32",margin:0},children:"Settings saved successfully."})}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("section",{style:{marginBottom:"1.5rem",padding:"1rem",border:"1px solid #e0e0e0",borderRadius:8,backgroundColor:"#fff"},children:[e.jsx("h2",{style:{fontSize:"1.1rem",marginTop:0},children:"Quiet Hours"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"#666",margin:"0 0 12px"},children:"During quiet hours, you won't be selected as an SOS recipient."}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",marginBottom:4},children:"Start"}),e.jsx("input",{type:"time",value:g,onChange:t=>p(t.target.value),style:{padding:"6px 8px",border:"1px solid #ccc",borderRadius:4}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.85rem",marginBottom:4},children:"End"}),e.jsx("input",{type:"time",value:m,onChange:t=>h(t.target.value),style:{padding:"6px 8px",border:"1px solid #ccc",borderRadius:4}})]}),g&&e.jsx("button",{type:"button",onClick:()=>{p(""),h("")},style:{alignSelf:"flex-end",padding:"6px 10px",fontSize:"0.85rem"},children:"Clear"})]})]}),e.jsxs("section",{style:{marginBottom:"1.5rem",padding:"1rem",border:"1px solid #e0e0e0",borderRadius:8,backgroundColor:"#fff"},children:[e.jsx("h2",{style:{fontSize:"1.1rem",marginTop:0},children:"Location Privacy"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"#666",margin:"0 0 12px"},children:"When disabled, buddies see approximate location only until they accept an SOS."}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:x,onChange:t=>y(t.target.checked),style:{width:18,height:18}}),e.jsx("span",{children:"Share precise location"})]})]}),e.jsx("button",{type:"submit",disabled:s,style:{padding:"10px 24px",backgroundColor:"#1976d2",color:"#fff",border:"none",borderRadius:4,fontSize:"1rem",cursor:s?"default":"pointer",fontWeight:500},children:s?"Saving...":"Save Settings"})]})]})}export{R as default};
