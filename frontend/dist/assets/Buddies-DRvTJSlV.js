import{g as h,r as a,j as e}from"./index-g3GU5JoN.js";import{g as y,p as g}from"./http-vazCWv24.js";import{g as f}from"./auth-D6vILSCL.js";async function x(r){const n=h();if(!n)throw new Error("Not authenticated");return g("/buddies/invite",r,n)}async function j(r){const n=h();if(!n)throw new Error("Not authenticated");return g(`/buddies/${r}/accept`,{},n)}async function v(r){const n=h();if(!n)throw new Error("Not authenticated");return g(`/buddies/${r}/block`,{},n)}async function b(){const r=h();if(!r)throw new Error("Not authenticated");return y("/buddies",r)}function B({onInvited:r}){const[n,d]=a.useState(""),[o,t]=a.useState(3),[s,c]=a.useState(""),[l,u]=a.useState(!1);async function m(i){i.preventDefault(),c(""),u(!0);try{await x({buddy_email:n,trust_level:o}),d(""),r()}catch(p){c(p instanceof Error?p.message:"Invite failed")}finally{u(!1)}}return e.jsxs("form",{onSubmit:m,style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{children:"Invite a Buddy"}),e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("input",{type:"email",placeholder:"Buddy's email",value:n,onChange:i=>d(i.target.value),required:!0,style:{padding:8,marginRight:8}}),e.jsx("select",{value:o,onChange:i=>t(Number(i.target.value)),style:{padding:8},children:[1,2,3,4,5].map(i=>e.jsxs("option",{value:i,children:["Trust ",i]},i))}),e.jsx("button",{type:"submit",disabled:l,style:{padding:"8px 16px",marginLeft:8},children:l?"Sending...":"Invite"})]}),s&&e.jsx("p",{style:{color:"red",margin:0},children:s})]})}function E({links:r,onUpdated:n}){async function d(t){try{await j(t),n()}catch(s){alert(s instanceof Error?s.message:"Accept failed")}}async function o(t){try{await v(t),n()}catch(s){alert(s instanceof Error?s.message:"Block failed")}}return r.length===0?e.jsx("p",{children:"No buddy links yet."}):e.jsx("ul",{style:{listStyle:"none",padding:0},children:r.map(t=>e.jsxs("li",{style:{padding:"0.75rem",border:"1px solid #ddd",borderRadius:4,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("strong",{children:t.other_name})," (",t.other_email,") â€” ",t.status," (trust ",t.trust_level,")"]}),t.status==="PENDING"&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("button",{onClick:()=>d(t.id),style:{marginRight:8,padding:"4px 12px"},children:"Accept"}),e.jsx("button",{onClick:()=>o(t.id),style:{padding:"4px 12px"},children:"Block"})]}),t.status==="ACCEPTED"&&e.jsx("button",{onClick:()=>o(t.id),style:{marginTop:8,padding:"4px 12px"},children:"Block"})]},t.id))})}function L(){const[r,n]=a.useState([]),[d,o]=a.useState(!0),[t,s]=a.useState("");async function c(){try{const l=localStorage.getItem("vetbridge_token");if(l){const[u,m]=await Promise.all([f(l),b()]);s(u.role),n(m)}}catch{n([])}finally{o(!1)}}return a.useEffect(()=>{c()},[]),d?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{style:{maxWidth:600,margin:"2rem auto",padding:"1rem"},children:[e.jsx("h1",{children:"My Buddies"}),t==="veteran"&&e.jsx(B,{onInvited:c}),e.jsx("h3",{children:"Buddy Links"}),e.jsx(E,{links:r,onUpdated:c})]})}export{L as default};
