import{g,p as y,a as $,r as a,j as e}from"./index-D52GenFk.js";import{g as A}from"./ai-tK4wdlQK.js";async function M(s){const i=g();if(!i)throw new Error("Not authenticated");return y("/ladder/plans",{weeks:s},i)}async function W(){const s=g();if(!s)throw new Error("Not authenticated");return $("/ladder/plans/latest",s)}async function B(s){const i=g();if(!i)throw new Error("Not authenticated");return y(`/ladder/challenges/${s}/complete`,{},i)}function X(){const[s,i]=a.useState(5),[f,w]=a.useState("Evening"),[j,k]=a.useState("low"),[N,C]=a.useState("coffee, fitness"),[x,L]=a.useState(""),[h,S]=a.useState(""),[o,l]=a.useState(!1),[v,r]=a.useState(null),[c,b]=a.useState(null),[m,p]=a.useState(null),u=a.useMemo(()=>m?m.challenges:c?c.weeks.map(t=>({id:`week-${t.week}`,week:t.week,title:t.title,difficulty:t.difficulty,rationale:t.rationale,suggested_time:t.suggested_time,status:"generated",completed:!1})):[],[c,m]),E=u.filter(t=>t.completed).length*100,P=(()=>{const t=[...u].sort((d,I)=>d.week-I.week);let n=0;for(const d of t)if(d.completed)n+=1;else break;return n})();async function _(){r(null),l(!0);try{const t={anxiety_level:s,preferred_time:f,crowd_tolerance:j,interests:N.split(",").map(d=>d.trim()).filter(Boolean),lat:x?Number(x):null,lng:h?Number(h):null},n=await A(t);b(n)}catch(t){r(t instanceof Error?t.message:"Failed to generate ladder")}finally{l(!1)}}async function G(){if(c){r(null),l(!0);try{const t=await M(c.weeks);p(t)}catch(t){r(t instanceof Error?t.message:"Failed to save plan")}finally{l(!1)}}}async function T(){r(null),l(!0);try{const t=await W();p(t),b(null)}catch(t){r(t instanceof Error?t.message:"No saved plan found")}finally{l(!1)}}async function F(t){r(null),l(!0);try{const n=await B(t);p(n)}catch(n){r(n instanceof Error?n.message:"Failed to complete challenge")}finally{l(!1)}}return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header animate-in",children:[e.jsx("h1",{className:"heading-xl",children:"Social Exposure Ladder"}),e.jsx("p",{className:"text-secondary text-lg mt-2",children:"Generate, save, and complete your 8-week plan."})]}),e.jsxs("section",{className:"card mb-6 animate-in animate-in-delay-1",children:[e.jsxs("div",{className:"flex-between mb-4",children:[e.jsx("h2",{className:"heading-md",children:"Intake"}),e.jsxs("div",{className:"text-sm text-secondary",children:["XP: ",e.jsx("strong",{children:E})," Â· Streak: ",e.jsx("strong",{children:P})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Anxiety (1-10)"}),e.jsx("input",{className:"input",type:"number",min:1,max:10,value:s,onChange:t=>i(Number(t.target.value))})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Preferred time"}),e.jsx("input",{className:"input",value:f,onChange:t=>w(t.target.value)})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Crowd tolerance"}),e.jsxs("select",{className:"select",value:j,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"med",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Interests (comma separated)"}),e.jsx("input",{className:"input",value:N,onChange:t=>C(t.target.value)})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Latitude"}),e.jsx("input",{className:"input",value:x,onChange:t=>L(t.target.value)})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Longitude"}),e.jsx("input",{className:"input",value:h,onChange:t=>S(t.target.value)})]})]}),e.jsxs("div",{className:"flex-center gap-sm mt-4",style:{justifyContent:"flex-start"},children:[e.jsx("button",{className:"btn btn-primary",onClick:_,disabled:o,children:"Generate Ladder"}),e.jsx("button",{className:"btn btn-secondary",onClick:G,disabled:o||!c,children:"Save Plan"}),e.jsx("button",{className:"btn btn-ghost",onClick:T,disabled:o,children:"Load Latest"})]}),v&&e.jsx("div",{className:"alert alert-danger mt-4",children:v})]}),e.jsxs("section",{className:"card animate-in animate-in-delay-2",children:[e.jsx("h2",{className:"heading-md mb-4",children:"Weeks 1-8"}),u.length===0?e.jsx("p",{className:"text-muted text-sm",children:"No ladder yet. Generate one to begin."}):e.jsx("div",{className:"grid-2",children:u.map(t=>e.jsxs("article",{className:"card card-hover",children:[e.jsxs("div",{className:"flex-between mb-2",children:[e.jsxs("span",{className:"badge",children:["Week ",t.week]}),e.jsx("span",{className:"text-muted text-xs",children:t.difficulty})]}),e.jsx("h3",{className:"heading-sm",children:t.title}),e.jsx("p",{className:"text-secondary text-sm mt-2",children:t.rationale}),e.jsxs("p",{className:"text-muted text-xs mt-2",children:["Suggested: ",t.suggested_time??"Flexible"]}),e.jsxs("div",{className:"mt-3 flex-between",children:[e.jsx("span",{className:`text-xs ${t.completed?"text-success":"text-muted"}`,children:t.completed?"Completed":t.status}),m&&!t.completed&&e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>F(t.id),disabled:o,children:"Complete"})]})]},t.id))})]})]})}export{X as default};
