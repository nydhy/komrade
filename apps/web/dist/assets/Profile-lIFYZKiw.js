import{r as n,j as e,g as U}from"./index-D52GenFk.js";import{g as z,u as M}from"./auth-CHILJdX7.js";import{s as Q}from"./geocode-Cak2rTCs.js";function J(){const[i,x]=n.useState(null),[E,F]=n.useState(!0),[h,p]=n.useState(!1),[g,l]=n.useState(null),[$,c]=n.useState(!1),[f,j]=n.useState(""),[P,o]=n.useState(""),[r,d]=n.useState(""),[y,m]=n.useState(null),[N,u]=n.useState(null),[v,b]=n.useState([]),[k,S]=n.useState(!1),[w,A]=n.useState(!1);n.useEffect(()=>{async function a(){try{const t=U();if(!t)return;const s=await z(t);if(x(s),j(s.full_name),m(s.latitude),u(s.longitude),s.latitude&&s.longitude)try{const L=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${s.latitude}&lon=${s.longitude}&format=json`,{headers:{"Accept-Language":"en"}});if(L.ok){const _=(await L.json()).display_name||`${s.latitude.toFixed(4)}, ${s.longitude.toFixed(4)}`;d(_),o(_)}}catch{d(`${s.latitude.toFixed(4)}, ${s.longitude.toFixed(4)}`)}}catch(t){l(t instanceof Error?t.message:"Failed to load profile")}finally{F(!1)}}a()},[]);async function C(a){o(a),d(""),S(!0);const t=await Q(a);b(t),S(!1)}function D(a){m(a.lat),u(a.lon),d(a.display_name),o(a.display_name),b([])}async function I(){A(!0),l(null);try{const a=await fetch("https://ipapi.co/json/");if(!a.ok)throw new Error("IP geolocation unavailable");const t=await a.json();if(t.latitude&&t.longitude){m(t.latitude),u(t.longitude);const s=[t.city,t.region,t.country_name].filter(Boolean).join(", ");d(s||`${t.latitude.toFixed(4)}, ${t.longitude.toFixed(4)}`),o(s||"")}else throw new Error("Could not determine location")}catch(a){l(a instanceof Error?a.message:"Auto-detect failed")}finally{A(!1)}}async function T(a){a.preventDefault(),p(!0),l(null),c(!1);try{const t=await M({full_name:f||void 0,latitude:y??void 0,longitude:N??void 0});x(t),c(!0),setTimeout(()=>c(!1),3e3)}catch(t){l(t instanceof Error?t.message:"Failed to save profile")}finally{p(!1)}}return E?e.jsx("div",{className:"page-container flex-center",style:{minHeight:"40vh"},children:e.jsx("p",{className:"text-secondary",children:"Loading profile..."})}):e.jsxs("div",{className:"page-container page-container-narrow",children:[e.jsxs("div",{className:"animate-in mb-8",children:[e.jsx("h1",{className:"heading-lg mb-2",children:"My Profile"}),e.jsx("p",{className:"text-muted",children:"Update your personal information and location"})]}),g&&e.jsx("div",{className:"alert alert-danger animate-in mb-4",children:g}),$&&e.jsx("div",{className:"alert alert-success animate-in mb-4",children:"Profile saved successfully."}),e.jsxs("form",{onSubmit:T,className:"flex-col gap-lg",children:[e.jsxs("section",{className:"card animate-in animate-in-delay-1",children:[e.jsx("h2",{className:"heading-md mb-4",children:"Account"}),e.jsx("div",{className:"divider mb-4"}),e.jsxs("div",{className:"profile-info-grid",children:[e.jsx("span",{className:"text-secondary text-sm",children:"Email"}),e.jsx("span",{className:"text-sm",children:i==null?void 0:i.email}),e.jsx("span",{className:"text-secondary text-sm",children:"Role"}),e.jsx("span",{className:"text-sm",style:{textTransform:"capitalize"},children:i==null?void 0:i.role}),e.jsx("span",{className:"text-secondary text-sm",children:"Joined"}),e.jsx("span",{className:"text-sm",children:i!=null&&i.created_at?new Date(i.created_at).toLocaleDateString():""})]})]}),e.jsxs("section",{className:"card animate-in animate-in-delay-2",children:[e.jsx("h2",{className:"heading-md mb-4",children:"Personal Info"}),e.jsx("div",{className:"divider mb-4"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Full Name"}),e.jsx("input",{type:"text",className:"input",value:f,onChange:a=>j(a.target.value),placeholder:"Your full name"})]})]}),e.jsxs("section",{className:"card animate-in animate-in-delay-3",children:[e.jsx("h2",{className:"heading-md mb-2",children:"Location"}),e.jsxs("p",{className:"text-muted text-sm mb-4",children:["Used for matching you with nearby ",(i==null?void 0:i.role)==="veteran"?"buddies":"veterans"]}),e.jsx("div",{className:"divider mb-4"}),y&&N&&r&&e.jsxs("div",{className:"badge badge-info mb-4",style:{fontSize:"var(--text-sm)",padding:"8px 14px"},children:["Current: ",r.split(",").slice(0,3).join(", ")]}),e.jsxs("div",{className:"input-group mb-3 relative",children:[e.jsx("label",{children:"Search Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:`input ${r?"input-success":""}`,value:P,onChange:a=>C(a.target.value),placeholder:"Search city, ZIP code, or address..."}),k&&e.jsx("span",{className:"profile-search-indicator text-muted text-xs",children:"Searching..."})]})]}),v.length>0&&e.jsx("div",{className:"profile-suggestions-dropdown mb-3",children:v.map((a,t)=>e.jsxs("button",{type:"button",className:"profile-suggestion-item",onClick:()=>D(a),children:[e.jsx("span",{className:"profile-suggestion-primary",children:a.display_name.split(",")[0]}),e.jsx("span",{className:"text-muted text-xs",children:a.display_name.includes(",")?", "+a.display_name.split(",").slice(1,3).join(",").trim():""})]},t))}),e.jsxs("button",{type:"button",className:"btn btn-ghost",onClick:I,disabled:w,children:[e.jsx("span",{children:"üìç"}),w?"Detecting...":"Auto-detect my location"]})]}),e.jsx("div",{className:"animate-in animate-in-delay-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary btn-lg w-full",disabled:h,children:h?"Saving...":"Save Profile"})})]})]})}export{J as default};
