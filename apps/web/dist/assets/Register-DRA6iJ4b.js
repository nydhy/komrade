import{r,h as M,j as e,L as O,s as Q}from"./index-D1iaHaPw.js";import{r as K,l as U}from"./auth-Dz8uO1Cl.js";import{s as X}from"./geocode-Cak2rTCs.js";const F=["Account","Role","Location"];function ee(a){if(a.length===0)return{label:"",color:"#e0e0e0",width:"0%"};let n=0;return a.length>=6&&n++,a.length>=10&&n++,/[A-Z]/.test(a)&&n++,/[0-9]/.test(a)&&n++,/[^A-Za-z0-9]/.test(a)&&n++,n<=1?{label:"Weak",color:"#e53935",width:"20%"}:n===2?{label:"Fair",color:"#fb8c00",width:"40%"}:n===3?{label:"Good",color:"#fdd835",width:"60%"}:n===4?{label:"Strong",color:"#43a047",width:"80%"}:{label:"Excellent",color:"#1b5e20",width:"100%"}}function re(){const[a,n]=r.useState(0),[c,_]=r.useState(""),[o,B]=r.useState(""),[i,I]=r.useState(""),[m,T]=r.useState(""),[l,y]=r.useState("veteran"),[u,v]=r.useState(null),[x,f]=r.useState(null),[$,p]=r.useState(""),[d,j]=r.useState(""),[g,N]=r.useState([]),[G,w]=r.useState(!1),[S,C]=r.useState(!1),[k,A]=r.useState(""),[R,E]=r.useState(""),[P,L]=r.useState(!1),[b,H]=r.useState(!1),Y=M(),h=ee(i),z=m.length===0||i===m;function q(){return a===0?c.trim().length>=2&&o.includes("@")&&i.length>=6&&i===m:!0}async function D(t){p(t),w(!0);const s=await X(t);N(s),w(!1)}function V(t){v(t.lat),f(t.lon),j(t.display_name),p(t.display_name),N([])}async function Z(){C(!0),A("");try{const t=await fetch("https://ipapi.co/json/");if(!t.ok)throw new Error("IP geolocation service unavailable");const s=await t.json();if(s.latitude&&s.longitude){v(s.latitude),f(s.longitude);const W=[s.city,s.region,s.country_name].filter(Boolean).join(", ");j(W||`${s.latitude.toFixed(4)}, ${s.longitude.toFixed(4)}`),p(W||"")}else throw new Error("Could not determine location")}catch(t){A(t instanceof Error?t.message:"Auto-detect failed. Please type your address above.")}finally{C(!1)}}async function J(){E(""),L(!0);try{await K({email:o,password:i,full_name:c,role:l,latitude:u??void 0,longitude:x??void 0});const s=await U({email:o,password:i});Q(s.access_token),Y("/",{replace:!0})}catch(t){E(t instanceof Error?t.message:"Registration failed")}finally{L(!1)}}return e.jsx("div",{className:"ambient-bg flex-center",style:{minHeight:"100vh",padding:"2rem 1rem"},children:e.jsxs("div",{className:"card glow-border animate-in",style:{width:"100%",maxWidth:480},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"heading-xl text-gradient mb-2",children:"VetBridge"}),e.jsx("p",{className:"text-muted text-sm",children:"Join the veteran support network"}),e.jsx("div",{className:"flex-center gap-2 mt-6",style:{gap:8},children:F.map((t,s)=>e.jsxs("div",{className:"flex-center",style:{gap:8},children:[e.jsx("div",{className:"flex-center",style:{width:32,height:32,borderRadius:"50%",fontSize:"0.8rem",fontWeight:700,backgroundColor:s<=a?"var(--accent-primary)":"var(--bg-glass)",color:s<=a?"#fff":"var(--text-muted)",boxShadow:s<=a?"0 0 12px rgba(129, 140, 248, 0.5)":"none",transition:"all 0.3s"},children:s<a?"âœ“":s+1}),e.jsx("span",{className:"text-sm",style:{fontWeight:600,color:s<=a?"var(--text-primary)":"var(--text-muted)"},children:t}),s<F.length-1&&e.jsx("div",{style:{width:24,height:2,backgroundColor:s<a?"var(--accent-primary)":"var(--border-default)",borderRadius:1}})]},t))})]}),e.jsx("hr",{className:"divider"}),e.jsxs("div",{className:"p-4",children:[a===0&&e.jsxs("div",{children:[e.jsx("h2",{className:"heading-md mb-6",children:"Create your account"}),e.jsxs("div",{className:"input-group mb-4",children:[e.jsx("label",{children:"Full Name"}),e.jsx("input",{type:"text",value:c,onChange:t=>_(t.target.value),placeholder:"John Doe",required:!0,className:"input"})]}),e.jsxs("div",{className:"input-group mb-4",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:o,onChange:t=>B(t.target.value),placeholder:"john@example.com",required:!0,autoComplete:"email",className:"input"})]}),e.jsxs("div",{className:"input-group mb-4",children:[e.jsx("label",{children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:b?"text":"password",value:i,onChange:t=>I(t.target.value),placeholder:"Min. 6 characters",required:!0,autoComplete:"new-password",className:"input",style:{paddingRight:"3rem"}}),e.jsx("button",{type:"button",onClick:()=>H(!b),className:"btn btn-ghost btn-sm absolute",style:{right:8,top:"50%",transform:"translateY(-50%)"},children:b?"Hide":"Show"})]}),i.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"overflow-hidden",style:{height:4,borderRadius:2,backgroundColor:"var(--border-default)"},children:e.jsx("div",{style:{height:"100%",width:h.width,backgroundColor:h.color,borderRadius:2,transition:"width 0.3s, background-color 0.3s"}})}),e.jsx("span",{className:"text-xs mt-1",style:{color:h.color,fontWeight:600,display:"block"},children:h.label})]})]}),e.jsxs("div",{className:"input-group mb-6",children:[e.jsx("label",{children:"Confirm Password"}),e.jsx("input",{type:"password",value:m,onChange:t=>T(t.target.value),placeholder:"Re-enter your password",required:!0,autoComplete:"new-password",className:`input ${z?"":"input-error"}`}),!z&&e.jsx("span",{className:"input-error-msg mt-1 text-xs",children:"Passwords don't match"})]}),e.jsx("button",{type:"button",onClick:()=>n(1),disabled:!q(),className:"btn btn-primary btn-lg w-full",children:"Continue"})]}),a===1&&e.jsxs("div",{children:[e.jsx("h2",{className:"heading-md mb-2",children:"How will you use VetBridge?"}),e.jsx("p",{className:"text-secondary text-sm mb-6",children:"Choose your role in the community"}),e.jsxs("div",{className:"flex-col gap-3 mb-6",style:{display:"flex",gap:12},children:[e.jsx("button",{type:"button",onClick:()=>y("veteran"),className:`card card-hover ${l==="veteran"?"card-glow":""}`,style:{textAlign:"left",borderColor:l==="veteran"?"var(--accent-primary)":void 0,boxShadow:l==="veteran"?"0 0 20px rgba(129, 140, 248, 0.25)":void 0},children:e.jsxs("div",{className:"flex-center",style:{gap:14,alignItems:"flex-start"},children:[e.jsx("div",{className:"flex-center",style:{width:48,height:48,borderRadius:12,background:l==="veteran"?"var(--gradient-accent)":"var(--bg-glass)",flexShrink:0},children:e.jsx("span",{style:{filter:l!=="veteran"?"grayscale(1) opacity(0.5)":"none",fontSize:"1.5rem"},children:"â­"})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"heading-sm",children:"I'm a Veteran"}),e.jsx("div",{className:"text-secondary text-sm mt-1",children:"Get matched with buddies, create check-ins, and send SOS alerts when you need support"})]}),l==="veteran"&&e.jsx("span",{className:"text-success",style:{fontSize:"1.2rem",fontWeight:700,flexShrink:0},children:"âœ“"})]})}),e.jsx("button",{type:"button",onClick:()=>y("buddy"),className:`card card-hover ${l==="buddy"?"card-glow":""}`,style:{textAlign:"left",borderColor:l==="buddy"?"var(--accent-primary)":void 0,boxShadow:l==="buddy"?"0 0 20px rgba(129, 140, 248, 0.25)":void 0},children:e.jsxs("div",{className:"flex-center",style:{gap:14,alignItems:"flex-start"},children:[e.jsx("div",{className:"flex-center",style:{width:48,height:48,borderRadius:12,background:l==="buddy"?"var(--gradient-accent)":"var(--bg-glass)",flexShrink:0},children:e.jsx("span",{style:{filter:l!=="buddy"?"grayscale(1) opacity(0.5)":"none",fontSize:"1.5rem"},children:"ðŸ¤"})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"heading-sm",children:"I'm a Buddy"}),e.jsx("div",{className:"text-secondary text-sm mt-1",children:"Support veterans by accepting invitations, responding to SOS alerts, and being there"})]}),l==="buddy"&&e.jsx("span",{className:"text-success",style:{fontSize:"1.2rem",fontWeight:700,flexShrink:0},children:"âœ“"})]})})]}),e.jsxs("div",{className:"flex-center gap-3",style:{gap:10},children:[e.jsx("button",{type:"button",onClick:()=>n(0),className:"btn btn-secondary",style:{flex:1},children:"Back"}),e.jsx("button",{type:"button",onClick:()=>n(2),className:"btn btn-primary btn-lg",style:{flex:1},children:"Continue"})]})]}),a===2&&e.jsxs("div",{children:[e.jsx("h2",{className:"heading-md mb-2",children:"Set your location"}),e.jsxs("p",{className:"text-secondary text-sm mb-6",children:["This helps match you with nearby ",l==="veteran"?"buddies":"veterans",". You can skip this and set it later."]}),e.jsxs("div",{className:"input-group mb-4",children:[e.jsx("label",{children:"Search your city, ZIP code, or address"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:$,onChange:t=>D(t.target.value),placeholder:"e.g. San Francisco, CA or 10001",className:"input",style:d?{borderColor:"var(--color-success)"}:void 0}),G&&e.jsx("span",{className:"text-muted text-xs absolute",style:{right:14,top:"50%",transform:"translateY(-50%)"},children:"Searching..."})]}),g.length>0&&e.jsx("div",{className:"overflow-hidden mt-2",style:{maxHeight:200,overflowY:"auto",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-default)",borderRadius:"var(--radius-md)"},children:g.map((t,s)=>e.jsxs("button",{type:"button",onClick:()=>V(t),className:"btn btn-ghost w-full text-left",style:{display:"block",padding:"10px 14px",borderBottom:s<g.length-1?"1px solid var(--border-default)":"none",borderRadius:0,fontSize:"0.85rem",color:"var(--text-primary)"},children:[e.jsx("span",{style:{fontWeight:500},children:t.display_name.split(",")[0]}),e.jsx("span",{className:"text-muted text-xs",children:t.display_name.includes(",")?", "+t.display_name.split(",").slice(1,3).join(",").trim():""})]},s))})]}),d&&u&&x&&e.jsxs("div",{className:"card card-highlight-success mb-4",style:{backgroundColor:"var(--color-success-bg)",borderColor:"var(--color-success-border)"},children:[e.jsxs("div",{className:"flex-center mb-2",style:{gap:8},children:[e.jsx("span",{style:{fontSize:"1.1rem"},children:"âœ…"}),e.jsx("span",{className:"heading-sm text-success",children:"Location set"})]}),e.jsx("p",{className:"text-secondary text-sm",style:{margin:0},children:d}),e.jsxs("p",{className:"text-muted text-xs mt-1",style:{margin:0},children:["Coordinates: ",u.toFixed(4),", ",x.toFixed(4)]})]}),e.jsxs("div",{className:"flex-center gap-3 my-4",children:[e.jsx("div",{className:"divider",style:{margin:0,flex:1}}),e.jsx("span",{className:"text-muted text-xs",style:{fontWeight:500},children:"or"}),e.jsx("div",{className:"divider",style:{margin:0,flex:1}})]}),e.jsxs("button",{type:"button",onClick:Z,disabled:S,className:"btn btn-secondary w-full mb-4",children:[e.jsx("span",{style:{fontSize:"1.1rem"},children:"ðŸ“"}),S?"Detecting location...":"Auto-detect my location"]}),k&&e.jsx("div",{className:"alert alert-warning mb-4",children:e.jsx("span",{children:k})}),R&&e.jsx("div",{className:"alert alert-danger mb-4",children:e.jsx("span",{children:R})}),e.jsxs("div",{className:"card mb-6",children:[e.jsx("div",{className:"heading-sm mb-4",children:"Account Summary"}),e.jsxs("div",{className:"text-sm",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px 16px"},children:[e.jsx("span",{className:"text-muted",children:"Name"}),e.jsx("span",{style:{color:"var(--text-primary)"},children:c}),e.jsx("span",{className:"text-muted",children:"Email"}),e.jsx("span",{style:{color:"var(--text-primary)"},children:o}),e.jsx("span",{className:"text-muted",children:"Role"}),e.jsx("span",{style:{color:"var(--text-primary)",textTransform:"capitalize"},children:l}),e.jsx("span",{className:"text-muted",children:"Location"}),e.jsx("span",{style:{color:"var(--text-primary)"},children:d?d.split(",").slice(0,2).join(", "):"Not set (optional)"})]})]}),e.jsxs("div",{className:"flex-center gap-3",style:{gap:10},children:[e.jsx("button",{type:"button",onClick:()=>n(1),className:"btn btn-secondary",style:{flex:1},children:"Back"}),e.jsx("button",{type:"button",onClick:J,disabled:P,className:"btn btn-primary btn-lg",style:{flex:1},children:P?"Creating Account...":"Create Account"})]})]}),e.jsx("div",{className:"text-center mt-6 pt-4",style:{borderTop:"1px solid var(--border-default)"},children:e.jsxs("span",{className:"text-secondary text-sm",children:["Already have an account?"," ",e.jsx(O,{to:"/login",className:"text-gradient",style:{fontWeight:600},children:"Sign in"})]})})]})]})})}export{re as default};
